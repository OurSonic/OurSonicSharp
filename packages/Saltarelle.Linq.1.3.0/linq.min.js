(function(r,h){var d={Identity:function(a){return a},True:function(){return true},Blank:function(){}},g={Boolean:typeof true,Number:typeof 0,String:typeof"",Object:typeof{},Undefined:typeof h,Function:typeof function(){}},b={createLambda:function(a){if(a==null)return d.Identity;if(typeof a==g.String)if(a=="")return d.Identity;else if(a.indexOf("=>")==-1){var l=new RegExp("[$]+","g"),b=0,i;while(i=l.exec(a)){var e=i[0].length;if(e>b)b=e}for(var f=[],c=1;c<=b;c++){for(var h="",k=0;k<c;k++)h+="$";f.push(h)}var m=Array.prototype.join.call(f,",");return new Function(m,"return "+a)}else{var j=a.match(/^[(\s]*([^()]*?)[)\s]*=>(.*)/);return new Function(j[1],"return "+j[2])}return a},isIEnumerable:function(a){if(typeof Enumerator!==g.Undefined)try{new Enumerator(a);return true}catch(b){}return false},isSupportDefineProperty:Object.defineProperties!=null,defineProperty:function(c,a,d){if(b.isSupportDefineProperty)Object.defineProperty(c,a,{enumerable:false,configurable:true,writable:true,value:d});else c[a]=d},compare:function(a,b){return a===b?0:a>b?1:-1},dispose:function(a){a!=null&&a.dispose()}},l={Before:0,Running:1,After:2},c=function(c,d,e){var b=new q,a=l.Before;this.current=b.current;this.moveNext=function(){try{switch(a){case l.Before:a=l.Running;c();case l.Running:if(d.apply(b))return true;else{this.dispose();return false}case l.After:return false}}catch(e){this.dispose();throw e;}};this.dispose=function(){if(a!=l.Running)return;try{e()}finally{a=l.After}}},q=function(){var a=null;this.current=function(){return a};this.yieldReturn=function(b){a=b;return true};this.yieldBreak=function(){return false}},a=function(a){this.getEnumerator=a};a.Utils={};a.Utils.createLambda=function(a){return b.createLambda(a)};a.Utils.createEnumerable=function(b){return new a(b)};a.Utils.createEnumerator=function(a,b,d){return new c(a,b,d)};a.Utils.extendTo=function(h){var d=h.prototype,f;if(h instanceof Array){f=e.prototype;b.defineProperty(d,"getSource",function(){return this})}else{f=a.prototype;b.defineProperty(d,"getEnumerator",function(){return a.from(this).getEnumerator()})}for(var c in f){var g=f[c];if(d[c]==g)continue;if(d[c]!=null){c=c+"ByLinq";if(d[c]==g)continue}g instanceof Function&&b.defineProperty(d,c,g)}};a.choice=function(){var b=arguments[0]instanceof Array?arguments[0]:arguments;return new a(function(){return new c(d.Blank,function(){return this.yieldReturn(b[Math.floor(Math.random()*b.length)])},d.Blank)})};a.cycle=function(){var b=arguments[0]instanceof Array?arguments[0]:arguments;return new a(function(){var a=0;return new c(d.Blank,function(){if(a>=b.length)a=0;return this.yieldReturn(b[a++])},d.Blank)})};a.empty=function(){return new a(function(){return new c(d.Blank,function(){return false},d.Blank)})};a.from=function(f){if(f==null)return a.empty();if(f instanceof a)return f;if(typeof f==g.Number||typeof f==g.Boolean)return a.repeat(f,1);if(typeof f==g.String)return new a(function(){var a=0;return new c(d.Blank,function(){return a<f.length?this.yieldReturn(f.charAt(a++)):false},d.Blank)});if(typeof f!=g.Function){if(typeof f.length==g.Number)return new e(f);if(!(f instanceof Object)&&b.isIEnumerable(f))return new a(function(){var b=true,a;return new c(function(){a=new Enumerator(f)},function(){if(b)b=false;else a.moveNext();return a.atEnd()?false:this.yieldReturn(a.item())},d.Blank)})}return new a(function(){var a=[],b=0;return new c(function(){for(var b in f)!(f[b]instanceof Function)&&a.push({key:b,value:f[b]})},function(){return b<a.length?this.yieldReturn(a[b++]):false},d.Blank)})},a.make=function(b){return a.repeat(b,1)};a.matches=function(f,e,b){if(b==null)b="";if(e instanceof RegExp){b+=e.ignoreCase?"i":"";b+=e.multiline?"m":"";e=e.source}if(b.indexOf("g")===-1)b+="g";return new a(function(){var a;return new c(function(){a=new RegExp(e,b)},function(){var b=a.exec(f);return b?this.yieldReturn(b):false},d.Blank)})};a.range=function(f,e,b){if(b==null)b=1;return new a(function(){var a,g=0;return new c(function(){a=f-b},function(){return g++<e?this.yieldReturn(a+=b):this.yieldBreak()},d.Blank)})};a.rangeDown=function(f,e,b){if(b==null)b=1;return new a(function(){var a,g=0;return new c(function(){a=f+b},function(){return g++<e?this.yieldReturn(a-=b):this.yieldBreak()},d.Blank)})};a.rangeTo=function(e,f,b){if(b==null)b=1;return e<f?new a(function(){var a;return new c(function(){a=e-b},function(){var c=a+=b;return c<=f?this.yieldReturn(c):this.yieldBreak()},d.Blank)}):new a(function(){var a;return new c(function(){a=e+b},function(){var c=a-=b;return c>=f?this.yieldReturn(c):this.yieldBreak()},d.Blank)})};a.repeat=function(e,b){return b!=null?a.repeat(e).take(b):new a(function(){return new c(d.Blank,function(){return this.yieldReturn(e)},d.Blank)})};a.repeatWithFinalize=function(d,e){d=b.createLambda(d);e=b.createLambda(e);return new a(function(){var a;return new c(function(){a=d()},function(){return this.yieldReturn(a)},function(){if(a!=null){e(a);a=null}})})};a.generate=function(e,f){if(f!=null)return a.generate(e).take(f);e=b.createLambda(e);return new a(function(){return new c(d.Blank,function(){return this.yieldReturn(e())},d.Blank)})};a.toInfinity=function(e,b){if(e==null)e=0;if(b==null)b=1;return new a(function(){var a;return new c(function(){a=e-b},function(){return this.yieldReturn(a+=b)},d.Blank)})};a.toNegativeInfinity=function(e,b){if(e==null)e=0;if(b==null)b=1;return new a(function(){var a;return new c(function(){a=e+b},function(){return this.yieldReturn(a-=b)},d.Blank)})};a.unfold=function(f,e){e=b.createLambda(e);return new a(function(){var b=true,a;return new c(d.Blank,function(){if(b){b=false;a=f;return this.yieldReturn(a)}a=e(a);return this.yieldReturn(a)},d.Blank)})};a.defer=function(d){return new a(function(){var e;return new c(function(){enumerator=a.from(d()).getEnumerator()},function(){return enumerator.moveNext()?this.yieldReturn(enumerator.current()):this.yieldBreak()},function(){b.dispose(enumerator)})})};a.prototype.traverseBreadthFirst=function(e,d){var f=this;e=b.createLambda(e);d=b.createLambda(d);return new a(function(){var g,i=0,h=[];return new c(function(){g=f.getEnumerator()},function(){while(true){if(g.moveNext()){h.push(g.current());return this.yieldReturn(d(g.current(),i))}var c=a.from(h).selectMany(function(a){return e(a)});if(!c.any())return false;else{i++;h=[];b.dispose(g);g=c.getEnumerator()}}},function(){b.dispose(g)})})};a.prototype.traverseDepthFirst=function(e,d){var f=this;e=b.createLambda(e);d=b.createLambda(d);return new a(function(){var h=[],g;return new c(function(){g=f.getEnumerator()},function(){while(true){if(g.moveNext()){var c=d(g.current(),h.length);h.push(g);g=a.from(e(g.current())).getEnumerator();return this.yieldReturn(c)}if(h.length<=0)return false;b.dispose(g);g=h.pop()}},function(){try{b.dispose(g)}finally{a.from(h).forEach(function(a){a.dispose()})}})})};a.prototype.flatten=function(){var e=this;return new a(function(){var g,f=null;return new c(function(){g=e.getEnumerator()},function(){while(true){if(f!=null)if(f.moveNext())return this.yieldReturn(f.current());else f=null;if(g.moveNext())if(g.current()instanceof Array){b.dispose(f);f=a.from(g.current()).selectMany(d.Identity).flatten().getEnumerator();continue}else return this.yieldReturn(g.current());return false}},function(){try{b.dispose(g)}finally{b.dispose(f)}})})};a.prototype.pairwise=function(d){var e=this;d=b.createLambda(d);return new a(function(){var a;return new c(function(){a=e.getEnumerator();a.moveNext()},function(){var b=a.current();return a.moveNext()?this.yieldReturn(d(b,a.current())):false},function(){b.dispose(a)})})};a.prototype.scan=function(f,d,g){if(g!=null)return this.scan(f,d).select(g);var e;if(d==null){d=b.createLambda(f);e=false}else{d=b.createLambda(d);e=true}var h=this;return new a(function(){var a,g,i=true;return new c(function(){a=h.getEnumerator()},function(){if(i){i=false;if(!e){if(a.moveNext())return this.yieldReturn(g=a.current())}else return this.yieldReturn(g=f)}return a.moveNext()?this.yieldReturn(g=d(g,a.current())):false},function(){b.dispose(a)})})};a.prototype.select=function(d){d=b.createLambda(d);if(d.length<=1)return new j(this,null,d);else{var e=this;return new a(function(){var a,f=0;return new c(function(){a=e.getEnumerator()},function(){return a.moveNext()?this.yieldReturn(d(a.current(),f++)):false},function(){b.dispose(a)})})}};a.prototype.selectMany=function(e,d){var f=this;e=b.createLambda(e);if(d==null)d=function(b,a){return a};d=b.createLambda(d);return new a(function(){var i,g=h,j=0;return new c(function(){i=f.getEnumerator()},function(){if(g===h)if(!i.moveNext())return false;do{if(g==null){var c=e(i.current(),j++);g=a.from(c).getEnumerator()}if(g.moveNext())return this.yieldReturn(d(i.current(),g.current()));b.dispose(g);g=null}while(i.moveNext());return false},function(){try{b.dispose(i)}finally{b.dispose(g)}})})};a.prototype.where=function(d){d=b.createLambda(d);if(d.length<=1)return new k(this,d);else{var e=this;return new a(function(){var a,f=0;return new c(function(){a=e.getEnumerator()},function(){while(a.moveNext())if(d(a.current(),f++))return this.yieldReturn(a.current());return false},function(){b.dispose(a)})})}};a.prototype.choose=function(d){d=b.createLambda(d);var e=this;return new a(function(){var a,f=0;return new c(function(){a=e.getEnumerator()},function(){while(a.moveNext()){var b=d(a.current(),f++);if(b!=null)return this.yieldReturn(b)}return this.yieldBreak()},function(){b.dispose(a)})})};a.prototype.ofType=function(b){var a;switch(b){case Number:a=g.Number;break;case String:a=g.String;break;case Boolean:a=g.Boolean;break;case Function:a=g.Function;break;default:a=null}return a===null?this.where(function(a){return a instanceof b}):this.where(function(b){return typeof b===a})};a.prototype.zip=function(){var g=arguments,d=b.createLambda(arguments[arguments.length-1]),e=this;if(arguments.length==2){var f=arguments[0];return new a(function(){var h,g,i=0;return new c(function(){h=e.getEnumerator();g=a.from(f).getEnumerator()},function(){return h.moveNext()&&g.moveNext()?this.yieldReturn(d(h.current(),g.current(),i++)):false},function(){try{b.dispose(h)}finally{b.dispose(g)}})})}else return new a(function(){var f,h=0;return new c(function(){var b=a.make(e).concat(a.from(g).takeExceptLast().select(a.from)).select(function(a){return a.getEnumerator()}).toArray();f=a.from(b)},function(){if(f.all(function(a){return a.moveNext()})){var a=f.select(function(a){return a.current()}).toArray();a.push(h++);return this.yieldReturn(d.apply(null,a))}else return this.yieldBreak()},function(){a.from(f).forEach(b.dispose)})})};a.prototype.merge=function(){var e=arguments,d=this;return new a(function(){var f,g=-1;return new c(function(){f=a.make(d).concat(a.from(e).select(a.from)).select(function(a){return a.getEnumerator()}).toArray()},function(){while(f.length>0){g=g>=f.length-1?0:g+1;var a=f[g];if(a.moveNext())return this.yieldReturn(a.current());else{a.dispose();f.splice(g--,1)}}return this.yieldBreak()},function(){a.from(f).forEach(b.dispose)})})};a.prototype.join=function(k,f,e,i,g){f=b.createLambda(f);e=b.createLambda(e);i=b.createLambda(i);g=b.createLambda(g);var j=this;return new a(function(){var l,o,m=null,n=0;return new c(function(){l=j.getEnumerator();o=a.from(k).toLookup(e,d.Identity,g)},function(){while(true){if(m!=null){var a=m[n++];if(a!==h)return this.yieldReturn(i(l.current(),a));a=null;n=0}if(l.moveNext()){var b=f(l.current());m=o.get(b).toArray()}else return false}},function(){b.dispose(l)})})};a.prototype.groupJoin=function(j,f,e,h,g){f=b.createLambda(f);e=b.createLambda(e);h=b.createLambda(h);g=b.createLambda(g);var i=this;return new a(function(){var k=i.getEnumerator(),l=null;return new c(function(){k=i.getEnumerator();l=a.from(j).toLookup(e,d.Identity,g)},function(){if(k.moveNext()){var a=l.get(f(k.current()));return this.yieldReturn(h(k.current(),a))}return false},function(){b.dispose(k)})})};a.prototype.all=function(a){a=b.createLambda(a);var c=true;this.forEach(function(b){if(!a(b)){c=false;return false}});return c};a.prototype.any=function(c){c=b.createLambda(c);var a=this.getEnumerator();try{if(arguments.length==0)return a.moveNext();while(a.moveNext())if(c(a.current()))return true;return false}finally{b.dispose(a)}};a.prototype.isEmpty=function(){return!this.any()};a.prototype.concat=function(){var d=this;if(arguments.length==1){var e=arguments[0];return new a(function(){var g,f;return new c(function(){g=d.getEnumerator()},function(){if(f==null){if(g.moveNext())return this.yieldReturn(g.current());f=a.from(e).getEnumerator()}return f.moveNext()?this.yieldReturn(f.current()):false},function(){try{b.dispose(g)}finally{b.dispose(f)}})})}else{var f=arguments;return new a(function(){var e;return new c(function(){e=a.make(d).concat(a.from(f).select(a.from)).select(function(a){return a.getEnumerator()}).toArray()},function(){while(e.length>0){var a=e[0];if(a.moveNext())return this.yieldReturn(a.current());else{a.dispose();e.splice(0,1)}}return this.yieldBreak()},function(){a.from(e).forEach(b.dispose)})})}};a.prototype.insert=function(f,d){var e=this;return new a(function(){var h,g,j=0,i=false;return new c(function(){h=e.getEnumerator();g=a.from(d).getEnumerator()},function(){if(j==f&&g.moveNext()){i=true;return this.yieldReturn(g.current())}if(h.moveNext()){j++;return this.yieldReturn(h.current())}return!i&&g.moveNext()?this.yieldReturn(g.current()):false},function(){try{b.dispose(h)}finally{b.dispose(g)}})})};a.prototype.alternate=function(b){b=a.make(b);return this.selectMany(function(c){return a.make(c).concat(b)}).takeExceptLast()};a.prototype.contains=function(d,a){a=b.createLambda(a);var c=this.getEnumerator();try{while(c.moveNext())if(a(c.current())===d)return true;return false}finally{b.dispose(c)}};a.prototype.defaultIfEmpty=function(d){var e=this;return new a(function(){var a,f=true;return new c(function(){a=e.getEnumerator()},function(){if(a.moveNext()){f=false;return this.yieldReturn(a.current())}else if(f){f=false;return this.yieldReturn(d)}return false},function(){b.dispose(a)})})};a.prototype.distinct=function(b){return this.except(a.empty(),b)};a.prototype.distinctUntilChanged=function(d){d=b.createLambda(d);var e=this;return new a(function(){var a,f,g;return new c(function(){a=e.getEnumerator()},function(){while(a.moveNext()){var b=d(a.current());if(g){g=false;f=b;return this.yieldReturn(a.current())}if(f===b)continue;f=b;return this.yieldReturn(a.current())}return this.yieldBreak()},function(){b.dispose(a)})})};a.prototype.except=function(e,d){d=b.createLambda(d);var g=this;return new a(function(){var h,i;return new c(function(){h=g.getEnumerator();i=new f(d);a.from(e).forEach(function(a){i.add(a)})},function(){while(h.moveNext()){var a=h.current();if(!i.contains(a)){i.add(a);return this.yieldReturn(a)}}return false},function(){b.dispose(h)})})};a.prototype.intersect=function(e,d){d=b.createLambda(d);var g=this;return new a(function(){var h,i,j;return new c(function(){h=g.getEnumerator();i=new f(d);a.from(e).forEach(function(a){i.add(a)});j=new f(d)},function(){while(h.moveNext()){var a=h.current();if(!j.contains(a)&&i.contains(a)){j.add(a);return this.yieldReturn(a)}}return false},function(){b.dispose(h)})})};a.prototype.sequenceEqual=function(f,d){d=b.createLambda(d);var e=this.getEnumerator();try{var c=a.from(f).getEnumerator();try{while(e.moveNext())if(!c.moveNext()||d(e.current())!==d(c.current()))return false;return c.moveNext()?false:true}finally{b.dispose(c)}}finally{b.dispose(e)}};a.prototype.union=function(e,d){d=b.createLambda(d);var g=this;return new a(function(){var k,i,j;return new c(function(){k=g.getEnumerator();j=new f(d)},function(){var b;if(i===h){while(k.moveNext()){b=k.current();if(!j.contains(b)){j.add(b);return this.yieldReturn(b)}}i=a.from(e).getEnumerator()}while(i.moveNext()){b=i.current();if(!j.contains(b)){j.add(b);return this.yieldReturn(b)}}return false},function(){try{b.dispose(k)}finally{b.dispose(i)}})})};a.prototype.orderBy=function(a){return new i(this,a,false)};a.prototype.orderByDescending=function(a){return new i(this,a,true)};a.prototype.reverse=function(){var b=this;return new a(function(){var a,e;return new c(function(){a=b.toArray();e=a.length},function(){return e>0?this.yieldReturn(a[--e]):false},d.Blank)})};a.prototype.shuffle=function(){var b=this;return new a(function(){var a;return new c(function(){a=b.toArray()},function(){if(a.length>0){var b=Math.floor(Math.random()*a.length);return this.yieldReturn(a.splice(b,1)[0])}return false},d.Blank)})};a.prototype.weightedSample=function(e){e=b.createLambda(e);var f=this;return new a(function(){var a,b=0;return new c(function(){a=f.choose(function(c){var a=e(c);if(a<=0)return null;b+=a;return{value:c,bound:b}}).toArray()},function(){if(a.length>0){var f=Math.floor(Math.random()*b)+1,e=-1,c=a.length;while(c-e>1){var d=Math.floor((e+c)/2);if(a[d].bound>=f)c=d;else e=d}return this.yieldReturn(a[c].value)}return this.yieldBreak()},d.Blank)})};a.prototype.groupBy=function(g,f,d,e){var h=this;g=b.createLambda(g);f=b.createLambda(f);if(d!=null)d=b.createLambda(d);e=b.createLambda(e);return new a(function(){var a;return new c(function(){a=h.toLookup(g,f,e).toEnumerable().getEnumerator()},function(){while(a.moveNext())return d==null?this.yieldReturn(a.current()):this.yieldReturn(d(a.current().key(),a.current()));return false},function(){b.dispose(a)})})};a.prototype.partitionBy=function(g,f,d,e){var i=this;g=b.createLambda(g);f=b.createLambda(f);e=b.createLambda(e);var h;if(d==null){h=false;d=function(b,a){return new n(b,a)}}else{h=true;d=b.createLambda(d)}return new a(function(){var j,l,m,k=[];return new c(function(){j=i.getEnumerator();if(j.moveNext()){l=g(j.current());m=e(l);k.push(f(j.current()))}},function(){var b;while((b=j.moveNext())==true)if(m===e(g(j.current())))k.push(f(j.current()));else break;if(k.length>0){var c=h?d(l,a.from(k)):d(l,k);if(b){l=g(j.current());m=e(l);k=[f(j.current())]}else k=[];return this.yieldReturn(c)}return false},function(){b.dispose(j)})})};a.prototype.buffer=function(e){var d=this;return new a(function(){var a;return new c(function(){a=d.getEnumerator()},function(){var b=[],c=0;while(a.moveNext()){b.push(a.current());if(++c>=e)return this.yieldReturn(b)}return b.length>0?this.yieldReturn(b):false},function(){b.dispose(a)})})};a.prototype.aggregate=function(c,b,a){return this.scan(c,b,a).last()};a.prototype.average=function(a){a=b.createLambda(a);var d=0,c=0;this.forEach(function(b){d+=a(b);++c});return d/c};a.prototype.count=function(a){a=a==null?d.True:b.createLambda(a);var c=0;this.forEach(function(d,b){if(a(d,b))++c});return c};a.prototype.max=function(a){if(a==null)a=d.Identity;return this.select(a).aggregate(function(a,b){return a>b?a:b})};a.prototype.min=function(a){if(a==null)a=d.Identity;return this.select(a).aggregate(function(a,b){return a<b?a:b})};a.prototype.maxBy=function(a){a=b.createLambda(a);return this.aggregate(function(b,c){return a(b)>a(c)?b:c})};a.prototype.minBy=function(a){a=b.createLambda(a);return this.aggregate(function(b,c){return a(b)<a(c)?b:c})};a.prototype.sum=function(a){if(a==null)a=d.Identity;return this.select(a).aggregate(0,function(a,b){return a+b})};a.prototype.elementAt=function(c){var b,a=false;this.forEach(function(e,d){if(d==c){b=e;a=true;return false}});if(!a)throw new Error("index is less than 0 or greater than or equal to the number of elements in source.");return b};a.prototype.elementAtOrDefault=function(d,c){var b,a=false;this.forEach(function(e,c){if(c==d){b=e;a=true;return false}});return!a?c:b};a.prototype.first=function(a){if(a!=null)return this.where(a).first();var c,b=false;this.forEach(function(a){c=a;b=true;return false});if(!b)throw new Error("first:No element satisfies the condition.");return c};a.prototype.firstOrDefault=function(a,b){if(b!=null)return this.where(b).firstOrDefault(a);var d,c=false;this.forEach(function(a){d=a;c=true;return false});return!c?a:d};a.prototype.last=function(a){if(a!=null)return this.where(a).last();var c,b=false;this.forEach(function(a){b=true;c=a});if(!b)throw new Error("last:No element satisfies the condition.");return c};a.prototype.lastOrDefault=function(a,b){if(b!=null)return this.where(b).lastOrDefault(a);var d,c=false;this.forEach(function(a){c=true;d=a});return!c?a:d};a.prototype.single=function(b){if(b!=null)return this.where(b).single();var c,a=false;this.forEach(function(b){if(!a){a=true;c=b}else throw new Error("single:sequence contains more than one element.");});if(!a)throw new Error("single:No element satisfies the condition.");return c};a.prototype.singleOrDefault=function(b,c){if(c!=null)return this.where(c).singleOrDefault(b);var d,a=false;this.forEach(function(b){if(!a){a=true;d=b}else throw new Error("single:sequence contains more than one element.");});return!a?b:d};a.prototype.skip=function(e){var d=this;return new a(function(){var a,f=0;return new c(function(){a=d.getEnumerator();while(f++<e&&a.moveNext());},function(){return a.moveNext()?this.yieldReturn(a.current()):false},function(){b.dispose(a)})})};a.prototype.skipWhile=function(d){d=b.createLambda(d);var e=this;return new a(function(){var a,g=0,f=false;return new c(function(){a=e.getEnumerator()},function(){while(!f)if(a.moveNext()){if(!d(a.current(),g++)){f=true;return this.yieldReturn(a.current())}continue}else return false;return a.moveNext()?this.yieldReturn(a.current()):false},function(){b.dispose(a)})})};a.prototype.take=function(e){var d=this;return new a(function(){var a,f=0;return new c(function(){a=d.getEnumerator()},function(){return f++<e&&a.moveNext()?this.yieldReturn(a.current()):false},function(){b.dispose(a)})})};a.prototype.takeWhile=function(d){d=b.createLambda(d);var e=this;return new a(function(){var a,f=0;return new c(function(){a=e.getEnumerator()},function(){return a.moveNext()&&d(a.current(),f++)?this.yieldReturn(a.current()):false},function(){b.dispose(a)})})};a.prototype.takeExceptLast=function(d){if(d==null)d=1;var e=this;return new a(function(){if(d<=0)return e.getEnumerator();var a,f=[];return new c(function(){a=e.getEnumerator()},function(){while(a.moveNext()){if(f.length==d){f.push(a.current());return this.yieldReturn(f.shift())}f.push(a.current())}return false},function(){b.dispose(a)})})};a.prototype.takeFromLast=function(d){if(d<=0||d==null)return a.empty();var e=this;return new a(function(){var h,f,g=[];return new c(function(){h=e.getEnumerator()},function(){while(h.moveNext()){g.length==d&&g.shift();g.push(h.current())}if(f==null)f=a.from(g).getEnumerator();return f.moveNext()?this.yieldReturn(f.current()):false},function(){b.dispose(f)})})};a.prototype.indexOf=function(b){var a=null;this.forEach(function(d,c){if(d===b){a=c;return false}});return a!==null?a:-1};a.prototype.lastIndexOf=function(b){var a=-1;this.forEach(function(d,c){if(d===b)a=c});return a};a.prototype.asEnumerable=function(){return a.from(this)};a.prototype.toArray=function(){var a=[];this.forEach(function(b){a.push(b)});return a};a.prototype.toLookup=function(d,c,a){d=b.createLambda(d);c=b.createLambda(c);a=b.createLambda(a);var e=new f(a);this.forEach(function(g){var f=d(g),a=c(g),b=e.get(f);if(b!==h)b.push(a);else e.add(f,[a])});return new p(e)};a.prototype.toObject=function(c,a){c=b.createLambda(c);a=b.createLambda(a);var d={};this.forEach(function(b){d[c(b)]=a(b)});return d};a.prototype.toDictionary=function(d,c,a){d=b.createLambda(d);c=b.createLambda(c);a=b.createLambda(a);var e=new f(a);this.forEach(function(a){e.add(d(a),c(a))});return e};a.prototype.toJSONString=function(a,b){if(typeof JSON===g.Undefined||JSON.stringify==null)throw new Error("toJSONString can't find JSON.stringify. This works native JSON support Browser or include json2.js");return JSON.stringify(this.toArray(),a,b)};a.prototype.toJoinedString=function(a,b){if(a==null)a="";if(b==null)b=d.Identity;return this.select(b).toArray().join(a)};a.prototype.doAction=function(d){var e=this;d=b.createLambda(d);return new a(function(){var a,f=0;return new c(function(){a=e.getEnumerator()},function(){if(a.moveNext()){d(a.current(),f++);return this.yieldReturn(a.current())}return false},function(){b.dispose(a)})})};a.prototype.forEach=function(c){c=b.createLambda(c);var d=0,a=this.getEnumerator();try{while(a.moveNext())if(c(a.current(),d++)===false)break}finally{b.dispose(a)}};a.prototype.write=function(a,c){if(a==null)a="";c=b.createLambda(c);var d=true;this.forEach(function(b){if(d)d=false;else document.write(a);document.write(c(b))})};a.prototype.writeLine=function(a,c){if(a==null)a="";c=b.createLambda(c);var d=true;this.forEach(function(b){if(d)d=false;else document.writeln(a);document.writeln(c(b))})};a.prototype.force=function(){var a=this.getEnumerator();try{while(a.moveNext());}finally{b.dispose(a)}};a.prototype.letBind=function(d){d=b.createLambda(d);var e=this;return new a(function(){var f;return new c(function(){f=a.from(d(e)).getEnumerator()},function(){return f.moveNext()?this.yieldReturn(f.current()):false},function(){b.dispose(f)})})};a.prototype.share=function(){var f=this,a,e=false;return new o(function(){return new c(function(){if(a==null)a=f.getEnumerator()},function(){if(e)throw new Error("enumerator is disposed");return a.moveNext()?this.yieldReturn(a.current()):false},d.Blank)},function(){e=true;b.dispose(a)})};a.prototype.memoize=function(){var g=this,e,a,f=false;return new o(function(){var b=-1;return new c(function(){if(a==null){a=g.getEnumerator();e=[]}},function(){if(f)throw new Error("enumerator is disposed");b++;return e.length<=b?a.moveNext()?this.yieldReturn(e[b]=a.current()):false:this.yieldReturn(e[b])},d.Blank)},function(){f=true;b.dispose(a);e=null})};a.prototype.catchError=function(d){d=b.createLambda(d);var e=this;return new a(function(){var a;return new c(function(){a=e.getEnumerator()},function(){try{return a.moveNext()?this.yieldReturn(a.current()):false}catch(b){d(b);return false}},function(){b.dispose(a)})})};a.prototype.finallyAction=function(d){d=b.createLambda(d);var e=this;return new a(function(){var a;return new c(function(){a=e.getEnumerator()},function(){return a.moveNext()?this.yieldReturn(a.current()):false},function(){try{b.dispose(a)}finally{d()}})})};a.prototype.log=function(a){a=b.createLambda(a);return this.doAction(function(b){typeof console!==g.Undefined&&console.log(a(b))})};a.prototype.trace=function(c,a){if(c==null)c="Trace";a=b.createLambda(a);return this.doAction(function(b){typeof console!==g.Undefined&&console.log(c,a(b))})};var i=function(e,a,c,d){this.source=e;this.keySelector=b.createLambda(a);this.descending=c;this.parent=d};i.prototype=new a;i.prototype.createOrderedEnumerable=function(a,b){return new i(this.source,a,b,this)};i.prototype.thenBy=function(a){return this.createOrderedEnumerable(a,false)};i.prototype.thenByDescending=function(a){return this.createOrderedEnumerable(a,true)};i.prototype.getEnumerator=function(){var f=this,b,a,e=0;return new c(function(){b=[];a=[];f.source.forEach(function(d,c){b.push(d);a.push(c)});var c=m.create(f,null);c.GenerateKeys(b);a.sort(function(a,b){return c.compare(a,b)})},function(){return e<a.length?this.yieldReturn(b[a[e++]]):false},d.Blank)};var m=function(a,b,c){this.keySelector=a;this.descending=b;this.child=c;this.keys=null};m.create=function(a,c){var b=new m(a.keySelector,a.descending,c);return a.parent!=null?m.create(a.parent,b):b};m.prototype.GenerateKeys=function(b){for(var d=b.length,e=this.keySelector,c=new Array(d),a=0;a<d;a++)c[a]=e(b[a]);this.keys=c;this.child!=null&&this.child.GenerateKeys(b)};m.prototype.compare=function(c,d){var a=b.compare(this.keys[c],this.keys[d]);if(a==0){if(this.child!=null)return this.child.compare(c,d);a=b.compare(c,d)}return this.descending?-a:a};var o=function(b,c){this.dispose=c;a.call(this,b)};o.prototype=new a;var e=function(a){this.getSource=function(){return a}};e.prototype=new a;e.prototype.any=function(b){return b==null?this.getSource().length>0:a.prototype.any.apply(this,arguments)};e.prototype.count=function(b){return b==null?this.getSource().length:a.prototype.count.apply(this,arguments)};e.prototype.elementAt=function(b){var c=this.getSource();return 0<=b&&b<c.length?c[b]:a.prototype.elementAt.apply(this,arguments)};e.prototype.elementAtOrDefault=function(a,c){var b=this.getSource();return 0<=a&&a<b.length?b[a]:c};e.prototype.first=function(c){var b=this.getSource();return c==null&&b.length>0?b[0]:a.prototype.first.apply(this,arguments)};e.prototype.firstOrDefault=function(c,d){if(d!=null)return a.prototype.firstOrDefault.apply(this,arguments);var b=this.getSource();return b.length>0?b[0]:c};e.prototype.last=function(c){var b=this.getSource();return c==null&&b.length>0?b[b.length-1]:a.prototype.last.apply(this,arguments)};e.prototype.lastOrDefault=function(c,d){if(d!=null)return a.prototype.lastOrDefault.apply(this,arguments);var b=this.getSource();return b.length>0?b[b.length-1]:c};e.prototype.skip=function(e){var b=this.getSource();return new a(function(){var a;return new c(function(){a=e<0?0:e},function(){return a<b.length?this.yieldReturn(b[a++]):false},d.Blank)})};e.prototype.takeExceptLast=function(a){if(a==null)a=1;return this.take(this.getSource().length-a)};e.prototype.takeFromLast=function(a){return this.skip(this.getSource().length-a)};e.prototype.reverse=function(){var b=this.getSource();return new a(function(){var a;return new c(function(){a=b.length},function(){return a>0?this.yieldReturn(b[--a]):false},d.Blank)})};e.prototype.sequenceEqual=function(b,c){return(b instanceof e||b instanceof Array)&&c==null&&a.from(b).count()!=this.count()?false:a.prototype.sequenceEqual.apply(this,arguments)};e.prototype.toJoinedString=function(b,d){var c=this.getSource();if(d!=null||!(c instanceof Array))return a.prototype.toJoinedString.apply(this,arguments);if(b==null)b="";return c.join(b)};e.prototype.getEnumerator=function(){var a=this.getSource(),b=-1;return{current:function(){return a[b]},moveNext:function(){return++b<a.length},dispose:d.Blank}};var k=function(b,a){this.prevSource=b;this.prevPredicate=a};k.prototype=new a;k.prototype.where=function(c){c=b.createLambda(c);if(c.length<=1){var e=this.prevPredicate,d=function(a){return e(a)&&c(a)};return new k(this.prevSource,d)}else return a.prototype.where.call(this,c)};k.prototype.select=function(c){c=b.createLambda(c);return c.length<=1?new j(this.prevSource,this.prevPredicate,c):a.prototype.select.call(this,c)};k.prototype.getEnumerator=function(){var d=this.prevPredicate,e=this.prevSource,a;return new c(function(){a=e.getEnumerator()},function(){while(a.moveNext())if(d(a.current()))return this.yieldReturn(a.current());return false},function(){b.dispose(a)})};var j=function(c,a,b){this.prevSource=c;this.prevPredicate=a;this.prevSelector=b};j.prototype=new a;j.prototype.where=function(c){c=b.createLambda(c);return c.length<=1?new k(this,c):a.prototype.where.call(this,c)};j.prototype.select=function(c){c=b.createLambda(c);if(c.length<=1){var e=this.prevSelector,d=function(a){return c(e(a))};return new j(this.prevSource,this.prevPredicate,d)}else return a.prototype.select.call(this,c)};j.prototype.getEnumerator=function(){var d=this.prevPredicate,e=this.prevSelector,f=this.prevSource,a;return new c(function(){a=f.getEnumerator()},function(){while(a.moveNext())if(d==null||d(a.current()))return this.yieldReturn(e(a.current()));return false},function(){b.dispose(a)})};var f=function(){var b=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},e=function(a){return a===null?"null":a===h?"undefined":typeof a.toString===g.Function?a.toString():Object.prototype.toString.call(a)},j=function(b,a){this.key=b;this.value=a;this.prev=null;this.next=null},f=function(){this.first=null;this.last=null};f.prototype={addLast:function(a){if(this.last!=null){this.last.next=a;a.prev=this.last;this.last=a}else this.first=this.last=a},replace:function(b,a){if(b.prev!=null){b.prev.next=a;a.prev=b.prev}else this.first=a;if(b.next!=null){b.next.prev=a;a.next=b.next}else this.last=a},remove:function(a){if(a.prev!=null)a.prev.next=a.next;else this.first=a.next;if(a.next!=null)a.next.prev=a.prev;else this.last=a.prev}};var i=function(a){this.countField=0;this.entryList=new f;this.buckets={};this.compareSelector=a==null?d.Identity:a};i.prototype={add:function(h,i){var g=this.compareSelector(h),f=e(g),c=new j(h,i);if(b(this.buckets,f)){for(var a=this.buckets[f],d=0;d<a.length;d++)if(this.compareSelector(a[d].key)===g){this.entryList.replace(a[d],c);a[d]=c;return}a.push(c)}else this.buckets[f]=[c];this.countField++;this.entryList.addLast(c)},"get":function(i){var c=this.compareSelector(i),g=e(c);if(!b(this.buckets,g))return h;for(var d=this.buckets[g],a=0;a<d.length;a++){var f=d[a];if(this.compareSelector(f.key)===c)return f.value}return h},"set":function(h,i){var d=this.compareSelector(h),g=e(d);if(b(this.buckets,g))for(var c=this.buckets[g],a=0;a<c.length;a++)if(this.compareSelector(c[a].key)===d){var f=new j(h,i);this.entryList.replace(c[a],f);c[a]=f;return true}return false},contains:function(g){var c=this.compareSelector(g),f=e(c);if(!b(this.buckets,f))return false;for(var d=this.buckets[f],a=0;a<d.length;a++)if(this.compareSelector(d[a].key)===c)return true;return false},clear:function(){this.countField=0;this.buckets={};this.entryList=new f},remove:function(g){var f=this.compareSelector(g),d=e(f);if(!b(this.buckets,d))return;for(var a=this.buckets[d],c=0;c<a.length;c++)if(this.compareSelector(a[c].key)===f){this.entryList.remove(a[c]);a.splice(c,1);if(a.length==0)delete this.buckets[d];this.countField--;return}},count:function(){return this.countField},toEnumerable:function(){var b=this;return new a(function(){var a;return new c(function(){a=b.entryList.first},function(){if(a!=null){var b={key:a.key,value:a.value};a=a.next;return this.yieldReturn(b)}return false},d.Blank)})}};return i}(),p=function(b){this.count=function(){return b.count()};this.get=function(c){return a.from(b.get(c))};this.contains=function(a){return b.contains(a)};this.toEnumerable=function(){return b.toEnumerable().select(function(a){return new n(a.key,a.value)})}},n=function(b,a){this.key=function(){return b};e.call(this,a)};n.prototype=new e;a.from=function(b){return function(f){var e=Type.safeCast(f,ss.IEnumerable);if(e){var d;return new a(function(){return new c(function(){d=e.getEnumerator()},function(){var a=d.moveNext();return a?this.yieldReturn(d.get_current()):false},function(){var a=Type.safeCast(d,ss.IDisposable);a&&a.dispose()})})}else return b(f)}}(a.from);a.prototype.toDictionary=function(a){return function(e,f,d,c){var b=a.call(this,f,d,c);b.defaultValue=e;return b}}(a.prototype.toDictionary);a.prototype.ofType=function(e){var d=this;return new a(function(){var a;return new c(function(){a=d.getEnumerator()},function(){while(a.moveNext()){var b=Type.safeCast(a.current(),e);if(ss.isValue(b))return this.yieldReturn(b)}return false},function(){b.dispose(a)})})};e.prototype.getEnumerator=function(a){return function(){var b=a.apply(this);b.get_current=b.current;return b}}(e.prototype.getEnumerator);a.registerClass("Enumerable",null,ss.IEnumerable);n.prototype.get_current=function(){return this.current()};n.registerClass("$Grouping",null,ss.IEnumerable);c.prototype.get_current=function(){return this.current()};c.prototype.reset=function(){throw new Error("Reset is not supported");};c.registerClass("$IEnumerator",null,ss.IDisposable);p.prototype.getEnumerator=function(){return this.toEnumerable().getEnumerator()};p.registerClass("$Lookup",null,ss.IEnumerable);f.prototype.get_item=function(a){if(!this.contains(a))throw new Error("Key "+a+" does not exist.");return this.get(a)};f.prototype.set_item=function(a){return function(c,b){a.call(this,c,b)}}(f.prototype.add);f.prototype.add=function(a){return function(b,c){if(this.contains(b))throw new Error("Key "+b+" already exists.");a.call(this,b,c)}}(f.prototype.add);f.prototype.remove=function(a){return function(b){var c=this.contains(b);a.call(this,b);return c}}(f.prototype.remove);f.prototype.get_count=function(){return this.count()};f.prototype.containsKey=function(a){return this.contains(a)};f.prototype.get_keys=function(){return this.toEnumerable().select(function(a){return a.key})};f.prototype.get_values=function(){return this.toEnumerable().select(function(a){return a.value})};f.prototype.getEnumerator=function(){return this.toEnumerable().getEnumerator()};f.prototype.tryGetValue=function(b,a){if(this.containsKey(b)){a.$=this.get(b);return true}else{a.$=this.defaultValue;return false}};f.registerClass("$LinqJSDictionary",null,ss.IEnumerable);if(typeof module!==g.Undefined&&module.exports)module.exports=a;else r.Enumerable=a})(this)